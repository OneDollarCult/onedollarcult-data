<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title data-i18n="home_title">OneDollarCult — Главная</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg:#0b0016;
      --bg2:#21004a;
      --card:#1b0235;
      --vio:#8b31ff;
      --muted:#d9d6ea;
      --btn:#ff0044;
    }
    *{ box-sizing:border-box }
    body{
      margin:0; color:#fff;
      background: radial-gradient(1100px 520px at 50% -10%, var(--bg2) 0%, var(--bg) 60%, #000 100%);
      font-family:'Russo One', system-ui, arial, sans-serif;
    }

    /* TOP BAR */
    .topbar{
      position:relative; padding:22px 16px 10px;
      display:flex; justify-content:center; align-items:center; flex-wrap:wrap;
      gap:10px 20px;
    }
    nav{ display:flex; gap:18px; align-items:center; justify-content:center; flex-wrap:wrap; }
    nav a{ color:#fff; text-decoration:none; font-size:20px }
    nav a:hover{ text-shadow:0 0 10px #fff3 }
    .right{
      display:flex; align-items:center; gap:12px;
      position:absolute; right:16px; top:14px;
    }
    .lang span{ display:none } /* как на остальных страницах */
    select{
      background:#1f033d; color:#fff; border:1px solid #7740ff; border-radius:9px;
      padding:6px 10px; font-family:'Russo One', sans-serif;
    }

    /* Socials */
    .socials{ display:flex; gap:12px; align-items:center }
    .socials a{
      display:inline-flex; width:28px; height:28px; border-radius:8px;
      align-items:center; justify-content:center; text-decoration:none;
      background:#13022c; box-shadow:inset 0 0 0 1px #7a27ff; transition:.2s;
    }
    .socials a:hover{ transform:translateY(-1px); box-shadow:inset 0 0 0 1px #9e6bff, 0 0 14px #7a27ff66 }

    /* На узких экранах переносим правый блок под меню — чтобы ничего не налезало */
    @media (max-width: 700px){
      .right{
        position:static; order:3; width:100%;
        justify-content:center; padding-top:4px;
      }
      .topbar{ padding-bottom:12px }
      nav a{ font-size:18px }
    }

    /* LAYOUT */
    .wrap{ max-width:980px; margin:10px auto 60px; padding:0 14px; }
    h1{
      text-align:center; margin:10px 0 18px; line-height:1.1;
      font-size:clamp(24px,6.2vw,44px); text-shadow:0 0 14px #f0f;
    }

    /* CARDS: строго столбиком */
    .col{ display:flex; flex-direction:column; gap:14px; }
    .card{
      background:var(--card);
      border-radius:18px;
      box-shadow:0 0 0 1px var(--vio), 0 0 22px #8b31ff40;
      padding:16px 16px 18px;
    }
    .card h2{
      margin:0 0 10px; font-size:clamp(18px,4.6vw,24px); line-height:1.15;
      display:flex; align-items:center; gap:10px;
    }
    .metric{
      font-size:clamp(24px,8vw,40px); line-height:1; letter-spacing:0.5px;
      text-shadow:0 0 12px #ffffff22;
    }
    .sub{ margin-top:6px; color:var(--muted); font-size:clamp(12px,3.6vw,16px) }

    /* Winner (одна корона, ширина как у остальных карточек) */
    .winner{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    .crown{
      width:28px; height:28px; flex:0 0 28px;
      filter: drop-shadow(0 0 8px #ffd54a55);
    }
    .winner .name{ font-size:clamp(18px,4.8vw,24px) }
    .winner .amount{ font-size:clamp(16px,4.2vw,20px); color:#ffd54a }
    .winner .date{ font-size:clamp(12px,3.6vw,16px); color:var(--muted) }

    /* CTA (опционально, если нужна кнопка) */
    .cta{
      display:block; width:100%; max-width:520px; margin:8px auto 0; text-align:center;
      background:var(--btn); color:#fff; text-decoration:none; border:0; cursor:pointer;
      font-size:clamp(18px,4.2vw,22px); padding:12px 18px; border-radius:14px;
      box-shadow:0 0 16px #ff3b73; transition:.2s;
      font-family:'Russo One', system-ui, arial, sans-serif;
    }
    .cta:hover{ background:#ff1f5c; box-shadow:0 0 22px #ff5b8e }
  </style>
  <script src="public/i18n.js"></script>
</head>
<body>
  <!-- Topbar -->
  <div class="topbar">
    <nav>
      <a href="index.html" data-i18n="nav_home">Главная</a>
      <a href="rules.html" data-i18n="nav_rules">Правила</a>
      <a href="winners.html" data-i18n="nav_winners">Победители</a>
      <a href="philosophy.html" data-i18n="nav_philosophy">Философия</a>
    </nav>
    <div class="right">
      <div class="socials" aria-label="Наши соцсети">
        <!-- ЗАМЕНИ href на реальные -->
        <a href="#" title="Telegram" aria-label="Telegram">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="#9e8cff" xmlns="http://www.w3.org/2000/svg">
            <path d="M9.03 15.42 8.9 18.1c.39 0 .56-.17.76-.38l1.83-1.76 3.79 2.77c.69.38 1.17.18 1.36-.64l2.47-11.59h.01c.22-1.01-.37-1.4-1.03-1.15L3.36 9.57c-.98.38-.96.93-.17 1.18l4.15 1.3 9.65-6.09c.45-.28.86-.13.52.15l-8.48 7.31Z"/>
          </svg>
        </a>
        <a href="#" title="X" aria-label="X">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="#9e8cff" xmlns="http://www.w3.org/2000/svg">
            <path d="M13.5 10.7 20.5 3h-1.7l-6 6.7L8.1 3H3l7.4 10.8L3 21h1.7l6.4-7.1 4 7.1H21l-7.5-10.3Zm-2.3 2.5-.74-1.08L5 4.2h2.3l3.63 5.47.74 1.08 5.74 8.65H16.8l-5.6-8.2Z"/>
          </svg>
        </a>
      </div>
      <div class="lang">
        <span data-i18n="lang_label">Язык</span>
        <select id="langSel">
          <option value="ru">RU</option>
          <option value="en">EN</option>
        </select>
      </div>
    </div>
  </div>

  <div class="wrap">
    <h1 data-i18n="home_h1">Один доллар. Один ритуал. Один победитель.</h1>

    <div class="col">
      <!-- 1) До ближайшего ритуала -->
      <section class="card" id="card-timer">
        <h2 data-i18n="next_ritual">До ближайшего ритуала</h2>
        <div class="metric" id="countdown">--д --ч --м --с</div>
        <div class="sub" id="countdownLabel" data-i18n="ritual_time_hint">Каждое воскресенье в 12:00 (МСК)</div>
      </section>

      <!-- 2) В игре — игроков -->
      <section class="card" id="card-players">
        <h2 data-i18n="players_in_game">В игре — игроков</h2>
        <div class="metric" id="playersCount">—</div>
        <div class="sub" data-i18n="players_hint">Читаем из базы участников</div>
      </section>

      <!-- 3) В банке — -->
      <section class="card" id="card-bank">
        <h2 data-i18n="bank_pool">В банке —</h2>
        <div class="metric" id="bankAmount">—</div>
        <div class="sub" data-i18n="bank_hint">50% от поступивших USDT (кошелёк Tron)</div>
      </section>

      <!-- 4) Победитель прошлой недели -->
      <section class="card" id="card-winner">
        <h2 data-i18n="last_winner">Победитель прошлой недели</h2>
        <div class="winner" id="winnerLine">
          <svg class="crown" viewBox="0 0 24 24" fill="#ffd54a" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M3 7l4.5 4 4.5-6 4.5 6L21 7l-2 10H5L3 7zM5 19h14v2H5v-2z"/>
          </svg>
          <span class="name" id="winnerName">—</span>
          <span class="amount" id="winnerAmount">—</span>
          <span class="date" id="winnerDate">—</span>
        </div>
      </section>
    </div>

    <!-- Опциональная кнопка -->
    <!-- <a class="cta" href="join.html" data-i18n="cta_join">Кинуть $1 и участвовать</a> -->
  </div>

  <script>
    // язык
    const sel = document.getElementById('langSel');
    if (typeof LANG !== 'undefined') sel.value = LANG;
    sel.addEventListener('change', e => I18N.setLang(e.target.value));

    // === Таймер до ближайшего воскресенья 12:00 МСК (UTC+3) ===
    const cdEl = document.getElementById('countdown');

    function nextRitualUTC() {
      const now = new Date();
      // Ритуал в 12:00 МСК = 09:00 UTC
      const targetUTC = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), 9, 0, 0, 0));
      // Найти ближайшее воскресенье
      const day = targetUTC.getUTCDay(); // 0=Вс
      const daysToSun = (7 - day) % 7;
      targetUTC.setUTCDate(targetUTC.getUTCDate() + daysToSun);
      // Если уже позже 09:00 UTC в это воскресенье — переносим на следующее
      const nowUTC = new Date();
      if (daysToSun === 0 && nowUTC > targetUTC) {
        targetUTC.setUTCDate(targetUTC.getUTCDate() + 7);
      }
      return targetUTC;
    }

    function pad(n){ return n.toString().padStart(2, '0'); }
    function tick() {
      const target = nextRitualUTC();
      const diff = target - new Date();
      if (diff <= 0) { cdEl.textContent = '00д 00ч 00м 00с'; return; }
      const s = Math.floor(diff/1000);
      const d = Math.floor(s/86400);
      const h = Math.floor((s%86400)/3600);
      const m = Math.floor((s%3600)/60);
      const sec = s%60;
      cdEl.textContent = `${pad(d)}д ${pad(h)}ч ${pad(m)}м ${pad(sec)}с`;
    }
    tick(); setInterval(tick, 1000);

    // === Хуки данных (оставлены, если есть твои функции) ===
    // players.json → количество игроков
    (function(){
      const el = document.getElementById('playersCount');
      if (typeof window.loadCounts === 'function') {
        window.loadCounts({ playersEl: el });
      } else {
        el.textContent = '—'; // плейсхолдер, пока нет функции
      }
    })();

    // TronScan API → банк
    (function(){
      const el = document.getElementById('bankAmount');
      if (typeof window.getBank === 'function') {
        window.getBank(el);
      } else {
        el.textContent = '—'; // плейсхолдер
      }
    })();

    // Последний победитель
    (function(){
      const nameEl = document.getElementById('winnerName');
      const amtEl  = document.getElementById('winnerAmount');
      const dateEl = document.getElementById('winnerDate');
      if (typeof window.getLastWinner === 'function') {
        window.getLastWinner({ nameEl, amtEl, dateEl });
      } else {
        nameEl.textContent = '—';
        amtEl.textContent  = '';
        dateEl.textContent = '';
      }
    })();
  </script>
</body>
</html>
