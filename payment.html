<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title data-i18n="pay_title">Оплата — OneDollarCult</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
  <style>
    body{ margin:0; padding:20px; font-family:'Russo One',sans-serif; color:#fff; text-align:center; background: radial-gradient(circle at center,#2a0055 0%, #0a0015 100%); }
    nav{ margin-bottom:20px; }
    nav a{ color:#fff; text-decoration:none; margin:0 10px; }
    .lang{ display:inline-flex; gap:8px; align-items:center; color:#bbb; font-size:14px; }
    select { background:#1f033d; color:#fff; border:1px solid #8000ff; border-radius:8px; padding:6px 10px; font-family:'Russo One', sans-serif; }

    .container{ background:#1f033d; display:inline-block; max-width:760px; width:95%; padding:26px; border-radius:14px; box-shadow:0 0 16px #8000ff; }
    h2{ margin:0 0 10px; text-shadow:0 0 8px #f0f; }
    p.lead{ margin:10px 0 8px; }
    .addr{ font-size:20px; color:#00ffcc; word-break:break-all; cursor:pointer; display:inline-block; padding:6px 10px; border-radius:8px; transition:transform .1s ease; }
    .addr:active{ transform:scale(0.98); }
    .hint{ color:#bdbbd2; }
    #qr-wrap{ margin:18px auto; display:inline-block; background:#fff; padding:12px; border-radius:12px; box-shadow:0 0 10px #5a00ff66; border:1px solid #7a2cff; }
    #qrcode > img, #qrcode > canvas{ width:220px; height:220px; display:block; }
    button{ margin-top:18px; background:#ff0044; color:#fff; border:0; border-radius:10px; padding:14px 34px; font-size:18px; cursor:pointer; box-shadow:0 0 14px #ff0044; font-family:'Russo One',sans-serif; }
    button:hover{ background:#ff2266; box-shadow:0 0 18px #ff2266; }
    #msg{ margin-top:12px; font-size:16px; color:#0f0; }
    .copied{ color:#9ef7ff; font-size:14px; margin-top:6px; }

    @media (max-width:599px){
      .addr{ font-size:18px; }
      button{ width:100%; }
    }
  </style>
  <script src="public/i18n.js"></script>
</head>
<body>
  <nav>
    <a href="index.html" data-i18n="nav_home">Главная</a> ·
    <a href="rules.html" data-i18n="nav_rules">Правила</a>
    <span class="lang"><span data-i18n="lang_label">Язык</span>
      <select id="langSel"><option value="ru">RU</option><option value="en">EN</option></select>
    </span>
  </nav>

  <div class="container">
    <h2 data-i18n="pay_title">Оплати 1 USDT (TRC-20)</h2>
    <p class="lead"><span data-i18n="pay_send_exact">Отправь ровно</span> <strong>1 USDT</strong> <span data-i18n="pay_to_addr">на адрес:</span></p>

    <div id="addrBox">
      <span id="address" class="addr">TX5iuanUcs1YubXrFyDtM3L7Jvhr4vWyij</span>
      <div id="copyNote" class="copied" style="display:none;" data-i18n="copied">Адрес скопирован</div>
    </div>

    <div id="qr-wrap"><div id="qrcode"></div></div>

    <p class="hint" data-i18n="pay_hint">Отсканируй QR или нажми на адрес, чтобы скопировать. После перевода нажми кнопку ниже.</p>

    <button onclick="checkPay()" data-i18n="btn_check">Я перевёл(а) — проверить</button>
    <div id="msg"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcodejs2@0.0.2/qrcode.min.js"></script>
  <script>
    document.getElementById('langSel').value = LANG;
    document.getElementById('langSel').addEventListener('change', e => I18N.setLang(e.target.value));

    const WALLET = 'TX5iuanUcs1YubXrFyDtM3L7Jvhr4vWyij';
    new QRCode(document.getElementById('qrcode'), { text: `tron:${WALLET}?amount=1`, width:220, height:220, colorDark:"#000", colorLight:"#fff", correctLevel: QRCode.CorrectLevel.M });

    const addrEl = document.getElementById('address');
    const noteEl = document.getElementById('copyNote');
    addrEl.addEventListener('click', async () => {
      try{ await navigator.clipboard.writeText(WALLET); noteEl.style.display='block'; setTimeout(()=>noteEl.style.display='none', 1200); }
      catch{ alert(WALLET); }
    });

    async function checkPay(){
      const payload = {
        nickname: localStorage.getItem('nickname') || '',
        email: localStorage.getItem('email') || '',
        avatar: localStorage.getItem('avatar') || ''
      };
      try{
        const res = await fetch('/api/check-payment', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        const data = await res.json();
        document.getElementById('msg').textContent = data.ok ? I18N.t('pay_ok') : (data.error || I18N.t('pay_fail'));
        document.getElementById('msg').style.color = data.ok ? '#0f0' : '#ff8080';
      }catch{
        document.getElementById('msg').textContent = I18N.t('pay_err');
        document.getElementById('msg').style.color = '#ff8080';
      }
    }
  </script>
</body>
</html>
